# 无人机控制台操作说明文档

## 系统概述

无人机控制台是一个基于 Qt 开发的无人机监控与控制平台，提供实时无人机状态监控、路径规划、障碍物检测等功能。系统采用模块化设计，包含多个功能组件。

## 主要功能模块

### 1. 主控制窗口 (CustomWindow)

- **功能**：系统主界面，负责整体协调和通信
- **特点**：集成所有子模块，提供统一的用户界面

### 2. 仪表盘 (CustomDashboard)

- **功能**：综合信息显示面板
- **包含组件**：
  - 无人机状态显示
  - 飞行信息面板
  - 缩略地图
  - 雷达显示
  - 指南针
  - 摇杆控制

### 3. 缩略地图 (MinimapWidget)

- **功能**：全局地图显示和无人机位置监控
- **特性**：
  - 实时显示所有无人机位置
  - 支持缩放和平移
  - 显示障碍物信息
  - 点击选择无人机

#### 地图操作

- **缩放**：使用鼠标滚轮或程序接口调整缩放级别 (0.3x - 2.0x)
- **平移**：通过程序接口设置地图中心点
- **选择无人机**：点击地图上的无人机图标进行选择

#### 障碍物显示

- **山体**：绿色圆圈，带三角形图标
- **雷达站**：紫色圆圈，带雷达扫描图标
- **雷云**：黄色圆圈，带云朵和闪电图标

### 4. 雷达显示 (RadarWidget)

- **功能**：以当前无人机为中心的探测范围显示
- **特性**：
  - 300 像素探测半径
  - 实时扫描动画
  - 显示探测范围内的其他无人机和障碍物

### 5. 指南针 (CompassWidget)

- **功能**：显示当前无人机的飞行方向
- **特性**：
  - 0 度为正北方向
  - 顺时针角度显示
  - 速度相关的颜色变化

### 6. 摇杆控制 (JoystickWidget)

- **功能**：手动控制无人机飞行
- **操作**：
  - 鼠标拖拽控制摇杆位置
  - 自动回中功能
  - 角度和距离计算

### 7. 无人机状态显示 (DroneStatusWidget)

- **功能**：显示选中无人机的详细信息
- **信息包括**：
  - 血量 (HP)
  - 位置坐标
  - 速度
  - 方向
  - 高度
  - 在线状态

## 操作指南

### 基本操作

#### 1. 启动系统

```bash
# 编译项目
qmake controller.pro
make

# 运行程序
./controller -platform vnc:size=786x490,depth=32,port=5907
```

#### 2. 无人机选择

- **方法 1**：在缩略地图上点击无人机图标
- **方法 2**：使用下拉菜单选择无人机
- **方法 3**：通过程序接口设置选中无人机

#### 3. 地图操作

- **缩放**：调用 `setZoomLevel(double zoom)` 方法
- **平移**：调用 `setCenter(const QPointF &center)` 方法
- **重置**：调用 `clearAll()` 方法清除所有数据

### 高级功能

#### 1. 障碍物管理

系统支持三种类型的障碍物：

**静态障碍物**：

- 山体 (Mountain)：永久保留在缩略图中
- 雷达站 (Radar)：永久保留在缩略图中

**动态障碍物**：

- 雷云 (Cloud)：定期清除过期数据

**管理方法**：

```cpp
// 清除所有障碍物
clearObstacles();

// 只清除动态障碍物
clearDynamicObstacles();

// 只清除静态障碍物
clearStaticObstacles();

// 清除过期的动态障碍物
clearStaleObstacles(1000); // 1秒超时
```

#### 2. 无人机控制

- **键盘控制**：通过主窗口的键盘事件处理
- **摇杆控制**：使用摇杆组件进行手动控制
- **自动控制**：通过程序接口发送控制命令

#### 3. 数据更新

系统通过以下方法更新无人机信息：

```cpp
// 更新无人机基本信息
updateDroneInfo(droneId, hp, pos, online);

// 更新飞行信息
updateFlightInfo(droneId, pos, speed, heading, altitude, hp);

// 更新雷达信息
updateRadarInfo(uid, pos, team, hp);
```

## 界面布局

### 主界面结构

```
┌─────────────────────────────────────────┐
│                标题栏                    │
├─────────────────────────────────────────┤
│  ┌─────────┐  ┌─────────┐  ┌─────────┐ │
│  │ 无人机   │  │ 飞行    │  │ 缩略    │ │
│  │ 状态     │  │ 信息     │  │ 地图     │ │
│  └─────────┘  └─────────┘  └─────────┘ │
├─────────────────────────────────────────┤
│  ┌─────────┐  ┌─────────┐  ┌─────────┐ │
│  │ 雷达     │  │ 指南针   │  │ 摇杆     │ │
│  │ 显示     │  │         │  │ 控制     │ │
│  └─────────┘  └─────────┘  └─────────┘ │
└─────────────────────────────────────────┘
```

## 颜色编码

### 无人机颜色

- **蓝色**：蓝队无人机 (B 队)
- **红色**：红队无人机 (R 队)
- **橙色**：当前选中的无人机
- **灰色**：离线无人机
- **白色**：血量为 0 的无人机

### 障碍物颜色

- **绿色**：山体障碍物
- **紫色**：雷达站障碍物
- **黄色**：雷云障碍物

## 通信协议

系统使用 QVsoa 通信协议与服务器进行数据交换：

### 连接管理

- 自动连接到指定服务器
- 支持断线重连
- 实时状态监控

### 数据格式

- 使用 JSON 格式进行数据交换
- 支持无人机状态、障碍物信息、游戏状态等数据

## 故障排除

### 常见问题

1. **地图不显示**

   - 检查地图边界设置
   - 确认无人机数据是否正确

2. **雷达无显示**

   - 检查当前无人机位置设置
   - 确认探测半径配置

3. **摇杆无响应**

   - 检查鼠标事件处理
   - 确认摇杆组件初始化

4. **通信连接失败**
   - 检查网络连接
   - 确认服务器地址和端口

### 调试信息

系统提供详细的调试输出，包括：

- 无人机位置更新
- 障碍物添加/清除
- 通信状态变化
- 用户操作记录

## 技术规格

### 系统要求

- **操作系统**：Windows/Linux/macOS
- **Qt 版本**：5.12.0 或更高
- **编译器**：支持 C++11 或更高

### 性能参数

- **地图尺寸**：1280x800 像素
- **雷达探测半径**：300 像素
- **更新频率**：可配置（默认 50ms）
- **缩放范围**：0.3x - 2.0x

### 内存使用

- **基础内存**：约 50MB
- **动态内存**：根据无人机数量线性增长
- **缓存管理**：自动清理过期数据

## 更新日志

### 版本 3.0

- 新增自定义 UI 界面
- 改进障碍物管理系统
- 优化地图显示性能
- 增强用户交互体验

### 版本 2.0

- 添加雷达显示功能
- 实现摇杆控制
- 支持多无人机管理

### 版本 1.0

- 基础无人机监控功能
- 简单地图显示
- 基本通信功能

## 联系信息

如有问题或建议，请联系开发团队。

---

2025 年
